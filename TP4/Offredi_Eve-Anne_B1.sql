/* DIVISON
Afficher, d’abord avec NOT EXISTS (et MINUS), puis avec un regroupement :
*/

-- 1. les noms des pilotes ayant travaillé pour toutes les compagnies.
SELECT nomPilote
FROM Pilote
WHERE NOT EXISTS
            (
            SELECT idComp
            FROM Compagnie

            MINUS 

            SELECT laComp
            FROM ATravaillePour
            WHERE lePilote = idPilote
            )
;

------------------------------------------------

SELECT nomPilote
FROM Pilote
    JOIN ATravaillePour ON idPilote = lePilote
GROUP BY nomPilote
HAVING COUNT (*) >=
        (
        SELECT COUNT (*)
        FROM Compagnie
        )
;


/*
NOMPILOTE           
--------------------
Fleurquin
*/

-- 2. les noms des pilotes ayant travaillé pour toutes les compagnies low cost.
SELECT nomPilote
FROM Pilote
WHERE NOT EXISTS
        (
        SELECT idComp
        FROM Compagnie
        WHERE estLowCost = 1

        MINUS 

        SELECT laComp
        FROM ATravaillePour
        WHERE lePilote = idPilote
        )
AND compPil IS NOT NULL
;

-----------------------------------------------------

SELECT nomPilote
FROM Pilote 
    JOIN ATravaillePour ON lePilote = idPilote
        JOIN Compagnie ON laComp = idComp
WHERE estLowCost = 1
GROUP BY nomPilote
HAVING COUNT(DISTINCT laComp) >= 
    (
    SELECT COUNT(DISTINCT idComp)
    FROM Compagnie
    WHERE estLowCost = 1
    )
;

/*
NOMPILOTE           
--------------------
Ridard
Naert
Fleurquin
*/


-- 3. les noms des pilotes ayant travaillé pour exactement toutes les compagnies low cost.

SELECT nomPilote
FROM Pilote
WHERE NOT EXISTS
    (
    SELECT idComp
    FROM Compagnie
    WHERE estLowCost = 1

    MINUS 

    SELECT laComp
    FROM ATravaillePour
    WHERE lePilote = idPilote
    )
AND NOT EXISTS
    (
    SELECT laComp
    FROM ATravaillePour
    WHERE lePilote = idPilote

    MINUS

    SELECT idComp
    FROM Compagnie
    WHERE estLowCost = 1
    )
AND compPil IS NOT NULL
;

---------------------------------------

SELECT nomPilote
FROM Pilote 
    JOIN ATravaillePour ON lePilote = idPilote
        JOIN Compagnie ON laComp = idComp
WHERE estLowCost = 1
GROUP BY nomPilote
HAVING COUNT(DISTINCT laComp) >= 
    (
    SELECT COUNT(DISTINCT idComp)
    FROM Compagnie
    WHERE estLowCost = 1
    )
INTERSECT

SELECT nomPilote
FROM Pilote 
    JOIN ATravaillePour ON lePilote = idPilote
GROUP BY nomPilote
HAVING COUNT(*) =
    (
    SELECT COUNT(DISTINCT idComp)
    FROM Compagnie
    WHERE estLowCost = 1
    )
;


/*
NOMPILOTE           
--------------------
Naert
*/

/* FONCTIONS DE GROUPE */

--1. Afficher le nombre de compagnies low cost (de deux manières différentes).
SELECT idComp , COUNT( * )
FROM Compagnie
WHERE estLowCost = 1
GROUP BY idComp
;

/*
    IDCOMP   COUNT(*)
---------- ----------
         5          1
         3          1
*/

SELECT COUNT(idComp)
FROM Compagnie
WHERE estLowCost = 1
GROUP BY nomComp
;

/*
COUNT(IDCOMP)
-------------
            1
            1
*/

--2. Afficher le nombre d’avions appartenant à Air France.
SELECT COUNT(idAvion)
FROM Avion, Compagnie
WHERE nomComp = 'Air France'
AND compAv = idComp
GROUP BY nomComp
;

/*
COUNT(IDAVION)
--------------
             3
*/

--3. Afficher le nombre de type d’avions appartenant à Ryanair.
SELECT compAv , COUNT( DISTINCT leTypeAvion )
FROM Avion, Compagnie
WHERE idComp = compAv
AND nomComp = 'Ryanair'
GROUP BY compAv
;

/*
    COMPAV COUNT(DISTINCTLETYPEAVION)
---------- --------------------------
         5                          1
*/

--4. Afficher le nombre total de passagers que peut transporter Air France.
SELECT SUM(nbPassagers)
FROM TypeAvion, Compagnie, Avion
WHERE nomComp = 'Air France'
AND idComp = compAv
AND leTypeAvion = idTypeAvion
;

/*
SUM(NBPASSAGERS)
----------------
             777
*/

--5. Afficher le type d’avion ayant la capacité maximale.
SELECT idTypeAvion
FROM TypeAvion
WHERE nbPassagers=
        (
        SELECT MAX(nbPassagers)
        FROM TypeAvion
        )
;

/*
IDTYPEAVION         
--------------------
A350
*/

--6. Afficher les compagnies (nom) ayant le type d’avion de capacité maximale.
SELECT nomComp
FROM Compagnie, Avion
WHERE compAv = idComp
AND leTypeAvion =
        (
        SELECT idTypeAvion
        FROM TypeAvion
        WHERE nbPassagers=
                (
                SELECT MAX(nbPassagers)
                FROM TypeAvion
                )
        )
;

/*
NOMCOMP                       
------------------------------
Air France
American Airlines
*/

/* REGROUPEMENT */

--1. Afficher le(s) pilote(s) ayant au moins deux qualifications
