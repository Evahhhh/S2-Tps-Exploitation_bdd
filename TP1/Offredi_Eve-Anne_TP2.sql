/*
R2.06 - TP2 - 04/02/22
Offredi Eve-Anne - Groupe B
---------------------------------
Les resultats seront presentes, en coherence avec la demande, dans l’ordre alphabetique des noms
(et des prenoms si besoin)
*/
-- Q1 : Pour chaque stagiaire (id), afficher le nom et le departement de l’entreprise --

SELECT etudStagiaire, nomEntreprise, depEntreprise
FROM Stagiaire, Entreprise
WHERE idEntreprise = entrepriseStage;

/*

ETUDSTAGIAIRE NOMENTREPRISE                            DEPENTREPRISE
------------- ---------------------------------------- -------------
     21903169 SMURFIT KAPPA FRANCE                                56
     21900272 SOLIDR                                              56
     21901179 SOLIDR                                              56

58 lignes sélectionnées. 

*/

-- Q2  : . Pour chaque stagiaire (nom et prenom), afficher le nom et le departement de l’entreprise

SELECT nomEtud, prenomEtud, nomEntreprise, depEntreprise
FROM Stagiaire, Etudiant, Entreprise
WHERE idEtud = etudstagiaire
AND entreprisestage = idEntreprise
ORDER BY nomEtud, prenometud;

/*

NOMETUD              PRENOMETUD           NOMENTREPRISE                            DEPENTREPRISE
-------------------- -------------------- ---------------------------------------- -------------
SIMAR                CEDRIC               CGI                                                 56
TRETON               PIERRE               SITIA                                               44
VIAUD                BENJAMIN             SCM VIAUD-FORMAGNE                                  56

58 lignes sélectionnées. 

*/

-- Q3 : Pour chaque etudiant (id), afficher son entreprise (nom) si elle existe et rien sinon.

SELECT idEtud, nomEntreprise
FROM Etudiant,
    (
    SELECT etudStagiaire idEtudiantEnt, nomentreprise
    FROM Stagiaire, Entreprise
    WHERE identreprise = entreprisestage
    UNION
    SELECT apprenti.etudapp idEtudiantEnt, nomentreprise
    FROM apprenti, Entreprise
    WHERE identreprise = entrepriseapp)
WHERE idEtud = idEtudiantEnt (+)
ORDER BY nomEtud;



/*

    IDETUD NOMENTREPRISE                           
---------- ----------------------------------------
  21902012                                         
  21902502                                         
  21902355                                         
  21902778                                         
  21905324                                         
  21900563                                         
  21906543                                         
  21903180                                         

107 lignes sélectionnées. 

*/

-- Q4 : Afficher les etudiants (nom et prenom) ayant realise un stage dans un departement different de celui du lycee.

SELECT nomEtud, prenomEtud
FROM Etudiant, Stagiaire, Entreprise
WHERE etudStagiaire = idEtud
AND entrepriseStage = idEntreprise
AND depEntreprise != depLycee
ORDER BY nomEtud, prenomEtud;

/*
NOMETUD              PRENOMETUD          
-------------------- --------------------
LAROQUE              ARTHUR              
MEAUZE               BAPTISTE            
MERIC-PONS           MATHIS              
MICHENEAU            TIMOTHE             
MIONET               PIERRE              
QUACH                VALENTIN            
QUINIOU              CHRISTOPHE          
RECOLIN              ANGELE              
VIAUD                BENJAMIN            

31 lignes selectionnees. 
*/

-- Q5 : Afficher les apprentis (nom et prenom) suivis par Muriel Mannevy.

SELECT nomEtud, prenomEtud
FROM Apprenti, Etudiant, Enseignant
WHERE etudApp = idEtud
AND tuteurApp = idEns
AND UPPER(nomEns) = 'MANNEVY'
AND UPPER(prenomEns) = 'MURIEL'
ORDER BY nomEtud, prenomEtud;

/*
NOMETUD              PRENOMETUD          
-------------------- --------------------
KOENIGS              THEO                
LE BRETON            DAN                 
LE PORS              YANIS               
MADELAINE            DYLAN               
PLOQUIN              NATHAN              
ROUILLIER            JULIEN              
TIRLEMONT            KIERIAN             

7 lignes selectionnees. 
*/

-- Q6 : Pour chaque tuteur d’apprenti (nom), afficher les apprentis (nom et prenom)

SELECT nomEns, nomEtud, prenomEtud
FROM Apprenti, Enseignant, Etudiant
WHERE tuteurApp = idEns
AND etudApp = idEtud
ORDER BY nomEns;

/*
NOMENS               NOMETUD              PRENOMETUD          
-------------------- -------------------- --------------------
Tuffigo              GUILLOUZO            BENJAMIN            
Tuffigo              DESMONTS             LEO                 

24 lignes sélectionnées. 
*/

-- Q7 : Afficher les tuteurs (nom) ayant suivi un apprenti en dehors de la Bretagne.

SELECT nomEns
FROM Enseignant, Apprenti, Entreprise
WHERE idEns = tuteurApp
AND entrepriseApp = idEntreprise
AND depEntreprise != '22'
AND depEntreprise != '29'
AND depEntreprise != '35'
AND depEntreprise != '56'
ORDER BY nomEns;

/*
NOMENS              
--------------------
Baudont
Mannevy
*/

-- Q8 : Pour chaque enseignant (nom), afficher les apprentis (nom et prenom) en Bretagne et le departement, tries dans l’ordre decroissant du departement, s’ils existent et rien sinon.

SELECT nomEns, nomEtud, prenomEtud, depEntreprise
FROM Enseignant, 
    (SELECT nomEns nomEnsTutBret, nomEtud, prenomEtud, depEntreprise
    FROM Apprenti, Enseignant, Entreprise, Etudiant
    WHERE idEns = tuteurapp
    AND idEtud = etudapp
    AND identreprise = entrepriseapp
    AND depEntreprise IN (56, 35, 29, 22))
WHERE nomEns = nomEnsTutBret (+)
ORDER BY nomEns, depEntreprise DESC ;

/*

NOMENS               NOMETUD              PRENOMETUD           DEPENTREPRISE
-------------------- -------------------- -------------------- -------------
Tuffigo              GUILLOUZO            BENJAMIN                        35
Volin                                                                       

35 lignes sélectionnées. 

*/

-- Q9 : Afficher les etudiants (nom et prenom) qui ont travaille dans le Morbihan et qui ont poursuivi leurs etudes a l’ENSIBS.

SELECT nomEtud, prenomEtud
FROM Etudiant, Apprenti, Entreprise
WHERE etudApp = idEtud
AND entrepriseApp = idEntreprise
AND depEntreprise = 56
AND UPPER(poursuiteEtudes) LIKE '%ENSIBS%'


UNION

SELECT nomEtud, prenomEtud
FROM Etudiant, Stagiaire, Entreprise
WHERE etudStagiaire = idEtud
AND entrepriseStage = idEntreprise
AND depEntreprise = 56
AND UPPER(poursuiteEtudes) LIKE '%ENSIBS%'
ORDER BY nomEtud, prenomEtud;

/*
NOMETUD              PRENOMETUD          
-------------------- --------------------
GARIN-HAMELINE       GILDAS              
GUENNEC              PAUL                
LE CHENADEC          SARAH               
LE GARREC            VINCENT             
PEDRON               MATISSE   
*/

-- Q10 : Afficher les enseignants (nom) a la fois tuteur de groupe en Info1 et tuteur d’apprenti.

SELECT DISTINCT nomEns
FROM Apprenti, Enseignant, GroupeInfo1
WHERE tuteurApp = idEns
AND tuteurGroupe = idEns
ORDER BY nomEns;

/*
NOMENS              
--------------------
Tuffigo
*/

-- Q11 : Afficher le nombre d’etudiants venant d’un lycee breton.

SELECT COUNT(*)
FROM Etudiant
WHERE depLycee IN (22,29,56,35);

/*
  COUNT(*)
----------
        81
*/

-- Q12 : Afficher le nombre de poursuites d’etudes renseignees.

SELECT COUNT(poursuiteEtudes)
FROM Etudiant;

/*
COUNT(POURSUITEETUDES)
----------------------
                    74
*/

-- Q13 : Afficher le nombre de tuteurs pour l’ensemble des apprentis

SELECT COUNT(DISTINCT tuteurApp)
FROM Apprenti;

/*
COUNT(DISTINCTTUTEURAPP)
------------------------
                       7
*/

-- Q14 : Afficher le nombre d’apprentis suivis par Pascal Baudont dans le Morbihan.

SELECT COUNT(*)
FROM Enseignant, Apprenti, Entreprise
WHERE tuteurApp = idEns
AND UPPER(nomEns) = 'BAUDONT'
AND UPPER(prenomEns) = 'PASCAL'
AND entrepriseApp = idEntreprise
AND depEntreprise = 56;

/*
  COUNT(*)
----------
         4
*/

-- Q15 : Afficher la proportion d’etudiants passes en deuxième annee

SELECT pass/npass 
FROM Etudiant,
    (
    SELECT COUNT(*) AS npass, pass
    FROM Etudiant,
        (
        SELECT COUNT(*) AS pass
        FROM Etudiant
        WHERE formationInfo2 IS NOT NULL
        )
    )
;

/*
  COUNT(*)
----------
        82
*/

-- Q16 : Afficher la proportion d’enseignants ayant suivi un apprenti

SELECT COUNT(DISTINCT tuteurApp)
FROM Apprenti;

/*
COUNT(DISTINCTTUTEURAPP)
------------------------
                       7
*/